<div class="fidelity-signup-wrapper">
  <!-- Alerts -->
  <div class="alert-container-inline" *ngIf="showAlert && alert.position === 'inline'">
    <fuse-alert
      class="w-full"
      [appearance]="'fill'"
      [showIcon]="true"
      [type]="alert.type"
      [@shake]="alert.type === 'error'">
      {{ alert.message }}
    </fuse-alert>
  </div>
  <div class="alert-container-bottom" *ngIf="showAlert && alert.position === 'bottom'">
    <fuse-alert
      class="custom-toast"
      [appearance]="'fill'"
      [showIcon]="true"
      [type]="alert.type">
      {{ alert.message }}
    </fuse-alert>
  </div>

  <!-- Left Branding Panel -->
  <div class="fidelity-brand-panel">
    <div class="brand-content">
      <img src="https://media.licdn.com/dms/image/v2/C4D0BAQGK4ya3Y0V4Iw/company-logo_200_200/company-logo_200_200/0/1631336758836?e=2147483647&v=beta&t=qRDfOKgxDnq46pE6Pv8nqRhBsJE-Qsz2AIfP0NssBzY" alt="Fidelity Insurance Logo" class="brand-logo" />
      <h1 class="brand-title">Insurance you can trust.</h1>
      <p class="brand-subtitle">Get a quick quote â€” no login required.</p>

      <div class="quote-cards">
        <div class="quote-card-item">
          <div>
            <h3>Golfers Insurance</h3>
            <p>Cover for your equipment & liability.</p>
          </div>
          <a href="/sign-up/golfers-quote">Get Quote</a>
        </div>
        <div class="quote-card-item">
          <div>
            <h3>Marine Insurance</h3>
            <p>Protect your vessels & cargo.</p>
          </div>
          <a href="sign-up/marine-quote" class="cursor-pointer" (click)="navigateToMarineQuote()">Get Quote</a>
        </div>
        <div class="quote-card-item">
          <div>
            <h3>Travel Insurance</h3>
            <p>Comprehensive travel coverage.</p>
          </div>
          <a href="sign-up/travel-quote" class="cursor-pointer" (click)="navigateToTravelQuote()">Get Quote</a>
        </div>
        <!-- NEW: Personal Accident Quote Card -->
        <div class="quote-card-item">
          <div>
            <h3>Personal Accident</h3>
            <p>Protection in case of unforeseen accidents.</p>
          </div>
          <a href="sign-up/personal-accident-quote" class="cursor-pointer" (click)="navigateToPersonalAccidentQuote()">Get Quote</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Form Panel -->
  <div class="fidelity-form-panel">
    <div class="form-container">

      <!-- Login Form -->
      <div *ngIf="formType === 'login'" class="animate-fade-in">
        <div class="form-header">
          <img src="https://media.licdn.com/dms/image/v2/C4D0BAQGK4ya3Y0V4Iw/company-logo_200_200/company-logo_200_200/0/1631336758836?e=2147483647&v=beta&t=qRDfOKgxDnq46pE6Pv8nqRhBsJE-Qsz2AIfP0NssBzY" alt="Fidelity Insurance Logo" class="form-logo" />
          <h2>Welcome Back</h2>
          <p>Sign in to the Fidelity Insurance Platform</p>
        </div>

        <form [formGroup]="signInForm" (ngSubmit)="signIn()">
          <div class="form-group">
            <label class="form-label">Email Address</label>
            <input type="email" class="form-input" formControlName="username" placeholder="your-email@fidelity.com">
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <div class="password-input-wrapper">
              <input [type]="showPassword ? 'text' : 'password'" class="form-input" formControlName="password" placeholder="Password">
              <button type="button" class="password-toggle-btn" (click)="togglePasswordVisibility()">
                <mat-icon class="text-base">{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </div>
          </div>

          <div class="mt-6 flex items-center justify-end text-sm">
            <a class="form-link" routerLink="/forgot-password">Forgot password?</a>
          </div>

          <button type="submit" class="btn-primary mt-4" [disabled]="signInForm.invalid || signInForm.disabled">
            <div *ngIf="!signInForm.disabled; else signingIn">Sign In</div>
            <ng-template #signingIn>
              <mat-progress-spinner [diameter]="20" mode="indeterminate"></mat-progress-spinner>
              <span>Signing in...</span>
            </ng-template>
          </button>
        </form>

        <div class="form-footer">
          <span>No account?</span>
          <a class="form-link ml-1" (click)="formType = 'register'">Register here</a>
        </div>
      </div>

      <!-- Registration Form -->
      <div *ngIf="formType === 'register'" class="animate-fade-in">
        <div class="form-header">
          <img src="https://i.imgur.com/lP1pS4o.png" alt="Fidelity Insurance Logo" class="form-logo" />
          <h2>Create Your Fidelity Account</h2>
          <p>Fill in the details below to get started</p>
        </div>

        <form [formGroup]="registerForm" (ngSubmit)="register()">
            <div class="form-group">
                <label class="form-label">Account Type</label>
                <mat-radio-group formControlName="accountType">
                    <mat-radio-button value="individual">Individual</mat-radio-button>
                    <mat-radio-button value="intermediary">Intermediary</mat-radio-button>
                </mat-radio-group>
            </div>

            <!-- Individual Fields -->
            <div *ngIf="registerForm.get('accountType').value === 'individual'">
              <div class="form-group"><label class="form-label">Full Name</label><input type="text" class="form-input" formControlName="fullName" placeholder="Full Name"></div>
              <div class="form-group"><label class="form-label">Email Address</label><input type="email" class="form-input" formControlName="email" placeholder="Email Address"></div>
              <div class="form-group"><label class="form-label">KRA PIN</label><input type="text" class="form-input" formControlName="kraPin" placeholder="KRA PIN"></div>
              <div class="form-group"><label class="form-label">Phone Number</label><input type="text" class="form-input" formControlName="phoneNumber" placeholder="Phone Number"></div>
            </div>

            <!-- Intermediary Fields -->
            <div *ngIf="registerForm.get('accountType').value === 'intermediary'">
                <div class="form-group"><label class="form-label">Intermediary - IRA Number</label><input type="text" class="form-input" formControlName="iraNumber" placeholder="IRA Number"></div>
                <div class="form-group"><label class="form-label">PIN Number</label><input type="text" class="form-input" formControlName="pinNumber" placeholder="PIN Number"></div>
            </div>

            <!-- Common Fields -->
            <div class="form-group">
              <label class="form-label">Password</label>
              <div class="password-input-wrapper">
                <input [type]="showPassword ? 'text' : 'password'" class="form-input" formControlName="password" placeholder="Create a password" required>
                <button type="button" class="password-toggle-btn" (click)="togglePasswordVisibility()">
                    <mat-icon class="text-base">{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
              </div>
            </div>

            <div class="mt-6 flex items-center">
              <mat-checkbox formControlName="agreementAccepted" id="agreement" class="flex-shrink-0"></mat-checkbox>
              <label for="agreement" class="ml-2">I agree to the <a href="javascript:void(0);" class="form-link">Terms</a> and <a href="javascript:void(0);" class="form-link">Privacy Policy</a>.</label>
            </div>

            <button type="submit" class="btn-primary mt-6" [disabled]="registerForm.invalid || registerForm.disabled">
              <div *ngIf="!registerForm.disabled; else registering">Create Account</div>
              <ng-template #registering>
                <mat-progress-spinner [diameter]="20" mode="indeterminate"></mat-progress-spinner>
                <span>Creating account...</span>
              </ng-template>
            </button>
        </form>

        <div class="form-footer">
          <span>Already have an account?</span>
          <a class="form-link ml-1" (click)="formType = 'login'">Sign In</a>
        </div>
      </div>
    </div>
  </div>
</div>